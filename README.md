# 汇编语言

> 直接在硬件之上工作的编程语言，首先了解硬件体系结构，才能更有效的应用汇编语言对其编程。与机器语言最接近的计算机语言

## 汇编语言特性

- 效率最高
- 开发驱动程序或嵌入式

## 学习汇编的好处

- CPU 和 Mem 如何工作
- 机器思维

## 机器语言

> 机器指令的集合

一台机器上正确执行的**命令**

- 指令
  - `PUSH AX)` 推进堆栈
  - 机器语言`01010000`

- S = 768 + 12288 - 1280
- 机器码：
  - 101100000000000000000011
  - 000001010000000000110000
  - 001011010000000000000101

## 汇编语言的产生

- 汇编语言的主题是**汇编指令**
- 汇编指令是机器指令的**助记符**

- 机器指令： `1000100111011000`
- 操作：寄存器 `BX` 的内容送到 `AX` 中
- 汇编指令：`MOV AX,BX`

### 寄存器

- CPU可以存储数据的器件，一个CPU中有多个寄存器。
- AX 是其中一个寄存器的代号
- BX 是另一个寄存器的代号

- 计算机只能读懂机器指令，那么如何让计算机执行程序员用汇编指令编写的程序？

programmer -> mov ax,bx(汇编指令) -> 编译器 -> 1000100111011000 -> 计算机

``` sh
# gcc -S main.c -o man.s
```

### 汇编语言的组成

1. 汇编指令（机器码的助记符）
2. 伪指令（有编译器执行）
3. 其他符号（有编译器识别）

CPU工作机制：《编码的奥秘》

汇编语言的指令决定了汇编语言的特性

### 存储器

- 控制整个计算机的运作和进行运算，提供**指令和数据**
- 指令和数据在存储器中存取

- 磁盘上的数据或程序读取到内存，CPU从内存里读取数据和程序并运行并发结果返回到内存中

### 指令和数据

- 在内存或磁盘上，指令和数据没有任何区别，都是二进制信息
- 二进制信息
  - `1000 1001 1101 1000` -> `89D8H` (数据)
  - `1000 1001 1101 1000` -> `MOV AX,BX` (程序)

### 存储单元

- 存储器被划分为若干个存储单元，每个存储单元从0开始顺序编号
- 一个存储器有128个存储单元，编号从 0 ~ 127

### CPU对存储器的读写

- CPU进行数据的读写，必须和外部器件进行三类信息的交互
  - 1.存储单元的**地址**（地址信息）
  - 2.器件的选择，读或写**命令**（控制信息）
  - 3.读或写的**数据**（数据信息）

- CPU是通过什么地址、数据和控制信息传到存储芯片中的呢？

- 电子计算机能处理、传输的信息都是电信号，电信号当然要用导线传送

- 专门有连接**CPU**和**其他芯片**的导线，通常称为**总线(bus)**
  - 物理上：一根根导线的集合
  - 逻辑上划分为
    - 地址总线
    - 数据总线
    - 控制总线

CPP -------地址总线------- 内存
CPP -------数据总线------- 内存
CPP -------控制总线------- 内存

读的过程：首先通过地址总线发送地址(数据存储的地址)，再通过控制总线发出读指令，在存储器中读方式取地址所在的数据并通过数据总线返回给CPU


写的过程：首先通过地址总线发送地址(数据存储的地址)，再通过控制总线发出写指令，CPU通过数据总线发送数据并覆盖地址总线发送的地址所对应的数据

### 地址总线

- CPU是通过地址总线来**指定存储单元**的
- 地址总线上能传送多少个不同的信息，CPU就可以对多少个存储单元进行**寻址**

- 64bit = CPU + OS + Software

- 地址纵向如何发送信息？

![地址纵向](./images/address.png)

地址总线从上到下，低地址(个位)到高地址(高位：千，万)。1101 0000 00 发送到内存，内存自动定位到1101 0000 00地址中。

一个CPU有N根地址总线，则可以说这个CPU的地址总线的宽度为N

这样的CPU最多可以寻找2的N次方个内存单元

1Byte = 8bit

### 数据总线

CPU与内存或其他器件之间的数据传送是通过数据总线来进行的。

**数据总线的宽度**决定了CPU和外界的**数据传送速度**

#### 向内存中写入数据89D8H时，是如何通过数据总线传送数据的

##### 8088CPU数据总线上的数据传送情况 - 8位数据总线上传送的信息

![8088CPU每次按8为传送](./images/data-send-8.png)

第一次先传送低位D8，再次传送高位89，需要传送二次才能送达到内存。如果每次一秒钟，需要二秒钟才能传完。

##### 8086CPU数据总线上的数据传送情况 - 每次传送16位

![8088CPU每次按8为传送](./images/data-send-8.png)

一次传送即可

### 控制总线

CPU对外部器件的控制是通过控制总线来进行的。是一些不同控制线的集合。

有多少根控制总线（读或写），就意味着CPU提供了对外部器件的多少种控制。

控制总线的宽度决定了CPU对外部器件的控制能力。

![控制总线](./images/data-control-line.png)

每一条线对应一个控制器件。1: 显示器读写，1：内存读，0...

- 内存读或写命令是由几根控制线综合发出的
  - 其中有一根名为读信号输出控制线负责由CPU向外传送读信号，CPU向该控制线上输出低电平表示将要读取数据；
  - 有一根名为写信号输出控制线负责由CPU向外传送写信号